Если packet объявить без volatile,
то даже по приходу
$888#
не срабатывает анализ этого массива в main(), хотя в отладчике кажется что с массивом всё хорошо.